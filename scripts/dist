#!/usr/bin/env bash

#
# == dist script ==
#
# Bundle up `bak` for:
#  * Debian        - .DEB
#  * RedHat        - .RPM
#  * Arch Linux    - .pkg.tar.zst
#  * Alpine Linux  - .apk
#  * Snap          - .snap
#  * FreeBSD       - .freebsd
#  * MacOS         - .pkg
#  * Generic       - .tar.gz
#
# Run from project root please!
# WARNING: The scripts in this folder are written specifically to run on MacOS [via Github Actions]
#

# NOTE: Most of the FPM options can be found it the .fpm file in the root of the project.

# Ensure the `dist` directory exists
rm -rf dist
mkdir -p dist

# Debian
fpm \
	-s dir -t deb \
	-p dist/bak-$(cat version)-1-any.deb \
	--version $(cat version) \
	--deb-changelog changelog.txt

# RedHat
fpm \
	-s dir -t rpm \
	-p dist/bak-$(cat version)-1-any.rpm \
	--version $(cat version) \
	--rpm-changelog changelog.txt

# Arch Linux
fpm \
	-s dir -t pacman \
	-p dist/bak-$(cat version)-1-any.pkg.tar.zst \
	--version $(cat version)

# Alpine Linux
fpm \
	-s dir -t apk \
	-p dist/bak-$(cat version)-1-any.apk \
	--version $(cat version)

# Snap
fpm \
	-s dir -t snap \
	-p dist/bak-$(cat version)-1-any.snap \
	--version $(cat version)

# FreeBSD
fpm \
	-s dir -t freebsd \
	-p dist/bak-$(cat version)-1-any.freebsd \
	--version $(cat version)

# MacOS
fpm \
	-s dir -t osxpkg \
	-p dist/bak-$(cat version)-1-any.pkg \
	--version $(cat version)

# Generic
tar -czf dist/bak-$(cat version)-1-any.tar.gz man source changelog.txt license.txt readme.txt version
